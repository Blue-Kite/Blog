---
title: Next.js에 Auth 프로세스 구현
description: Supabase를 활용해보자
date: 2025-12-25
category: dev
---

## 들어가며

사이드 프로젝트에 인증 인가 프로세스가 있어야 할 거 같았다. 백엔드 API + DB 조합으로 구현하는 건 약간 배보다 배꼽이 큰 거 같아서... 기존에 이용하던 Supabase를 최대한 활용해보고자 했다.

### Next.js 서버 액션이란?

Next.js 서버 액션은 서버에서 실행되지만 브라우저에서 호출할 수 있는 비동기 함수다. 
주로 `<form>`의 action prop이나 `<button>`의 formAction prop에 전달하여 사용한다.
서버 액션의 로직은 클라이언트 단에 노출이 되지 않고 직접적으로 DB인 Supabase를 제어할 수 있었다.
`use server`라는 키워드를 로직이 시작하기 전에 추가한다.

### Supabase를 왜 사용했는가?
공식문서가 잘 정리되어 있고 블로그 예제도 많았다. 그리고 무료 티어가 너무 꿀이었다. 25$ 플랜 도달은 그때 가서 걱정해도 될 거 같았다. 일주일 이상 사용을 안 하면 프로젝트가 통으로 비활성화 되는 단점이 있지만... 무료인 거 감안하면 괜찮은 선택지라고 판단했다.

**RLS 정책** 

Supabase의 보안과 관련된 정책으로 RLS 정책을 빼놓을 수 없다. Supabase 공식문서에 따르면, public 스키마의 모든 테이블에서 RLS를 활성화하라고 권장한다. 특정 조건의 해당하는 사용자가 정책에 따라 스키마의 행에 접근할 수 있다.

Supabase의 User는 2가지 종류이다.

annon : 인증이 안 된 사용자(= 로그인 안 한 사용자)
authenticated: 인증된 사용자(= 로그인 한 사용자)

anno 사용자(혹은 세션이 만료된 사용자)는 `USING (auth.uid() = user_id)` 이 조건에서 실패하는데 `auth.uid()`가 null를 반환하기 때문이다.


## 참고
1. 공식문서
- [Next.js Server Action](https://github.com/d5br5/nextjs-tailwind-blog)